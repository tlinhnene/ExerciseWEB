<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dự báo thời tiết – Lê Thị Trúc Linh - K234111395</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="mainstyle.css" />
  <script>
    let data = [
      {"value":"2347719","name":"An Giang"},{"value":"20070078","name":"Bình Dương"},
      {"value":"20070086","name":"Bình Phước"},{"value":"2347731","name":"Bình Thuận"},
      {"value":"2347730","name":"Bình Định"},{"value":"20070081","name":"Bạc Liêu"},
      {"value":"20070087","name":"Bắc Giang"},{"value":"20070084","name":"Bắc Kạn"},
      {"value":"20070088","name":"Bắc Ninh"},{"value":"2347703","name":"Bến Tre"},
      {"value":"2347704","name":"Cao Bằng"},{"value":"20070082","name":"Cà Mau"},
      {"value":"2347732","name":"Cần Thơ"},{"value":"28301718","name":"Điện Biên"},
      {"value":"20070085","name":"Đà Nẵng"},{"value":"1252375","name":"Đà Lạt"},
      {"value":"2347720","name":"Đắk Lắk"},{"value":"28301719","name":"Đắk Nông"},
      {"value":"2347721","name":"Đồng Nai"},{"value":"2347722","name":"Đồng Tháp"},
      {"value":"2347733","name":"Gia Lai"},{"value":"2347727","name":"Hà Nội"},
      {"value":"2347728","name":"TP. Hồ Chí Minh"},{"value":"2347734","name":"Hà Giang"},
      {"value":"2347741","name":"Hà Nam"},{"value":"2347736","name":"Hà Tĩnh"},
      {"value":"2347737","name":"Hòa Bình"},{"value":"20070079","name":"Hưng Yên"},
      {"value":"20070080","name":"Hải Dương"},{"value":"2347707","name":"Hải Phòng"},
      {"value":"28301720","name":"Hậu Giang"},{"value":"2347738","name":"Khánh Hòa"},
      {"value":"2347723","name":"Kiên Giang"},{"value":"20070076","name":"Kon Tum"},
      {"value":"2347708","name":"Lai Châu"},{"value":"2347710","name":"Long An"},
      {"value":"2347740","name":"Lào Cai"},{"value":"2347709","name":"Lâm Đồng"},
      {"value":"2347718","name":"Lạng Sơn"},{"value":"20070089","name":"Nam Định"},
      {"value":"2347742","name":"Nghệ An"},{"value":"2347743","name":"Ninh Bình"},
      {"value":"2347744","name":"Ninh Thuận"},{"value":"20070091","name":"Phú Thọ"},
      {"value":"2347745","name":"Phú Yên"},{"value":"2347746","name":"Quảng Bình"},
      {"value":"2347711","name":"Quảng Nam"},{"value":"20070077","name":"Quảng Ngãi"},
      {"value":"2347712","name":"Quảng Ninh"},{"value":"2347747","name":"Quảng Trị"},
      {"value":"2347748","name":"Sóc Trăng"},{"value":"2347713","name":"Sơn La"},
      {"value":"2347715","name":"Thanh Hóa"},{"value":"2347716","name":"Thái Bình"},
      {"value":"20070083","name":"Thái Nguyên"},{"value":"2347749","name":"Thừa Thiên Huế"},
      {"value":"2347717","name":"Tiền Giang"},{"value":"2347750","name":"Trà Vinh"},
      {"value":"2347751","name":"Tuyên Quang"},{"value":"2347714","name":"Tây Ninh"},
      {"value":"2347752","name":"Vĩnh Long"},{"value":"20070090","name":"Vĩnh Phúc"},
      {"value":"2347729","name":"Vũng Tàu"},{"value":"2347753","name":"Yên Bái"}
    ];
  </script>
</head>
<body>
  <div class="wrap">
    <header class="head">
      <h1>Dự báo thời tiết Việt Nam</h1>
      <p class="sub">Nguồn dữ liệu từ Tuổi Trẻ Weather API</p>
    </header>

    <section class="toolbar">
      <div class="select-box">
        <label for="province-select">Chọn tỉnh thành</label>
        <select id="province-select">
          <option value="">Đang chờ lựa chọn</option>
        </select>
      </div>
      <button id="refresh" class="btn">Làm mới</button>
    </section>

    <section id="weather-display" class="grid" style="display:none">
      <article class="card now">
        <h2 id="location" class="place"></h2>
        <img id="current-icon" class="icon-lg" src="" alt="Biểu tượng thời tiết">
        <p id="temperature" class="temp"></p>
        <p id="status" class="state"></p>
      </article>

      <aside class="card detail">
        <div class="stats">
          <div class="item"><strong>Cao nhất</strong><span id="high"></span>°C</div>
          <div class="item"><strong>Thấp nhất</strong><span id="low"></span>°C</div>
          <div class="item"><strong>Cảm giác như</strong><span id="feels-like"></span>°C</div>
          <div class="item"><strong>Độ ẩm</strong><span id="humidity"></span></div>
          <div class="item"><strong>Tầm nhìn</strong><span id="visibility"></span></div>
          <div class="item"><strong>UV Index</strong><span id="uv-index"></span></div>
          <div class="item"><strong>Gió</strong><span id="wind"></span></div>
          <div class="item"><strong>Mặt trời mọc</strong><span id="sunrise"></span></div>
          <div class="item"><strong>Mặt trời lặn</strong><span id="sunset"></span></div>
        </div>
      </aside>
    </section>

    <section class="forecast-wrap" style="display:none">
      <h3>Dự báo 7 ngày</h3>
      <div id="forecast" class="forecast"></div>
    </section>

    <div id="skeleton" class="skeleton" style="display:none">
      <div class="sk-card"></div>
      <div class="sk-card"></div>
      <div class="sk-row"></div>
    </div>
  </div>

  <script>
    const selectEl = document.getElementById('province-select');
    const refreshBtn = document.getElementById('refresh');
    const weatherWrap = document.getElementById('weather-display');
    const forecastWrap = document.querySelector('.forecast-wrap');
    const skeleton = document.getElementById('skeleton');

    data.forEach(p => {
      const op = document.createElement('option');
      op.value = p.value;
      op.textContent = p.name;
      selectEl.appendChild(op);
    });

    selectEl.addEventListener('change', () => selectEl.value ? fetchWeather(selectEl.value) : hideAll());
    refreshBtn.addEventListener('click', () => selectEl.value ? fetchWeather(selectEl.value, true) : null);

    function hideAll() {
      weatherWrap.style.display = 'none';
      forecastWrap.style.display = 'none';
    }

    async function fetchWeather(code, isRefresh=false) {
      try {
        skeleton.style.display = 'grid';
        weatherWrap.style.display = 'none';
        forecastWrap.style.display = 'none';

        const url = `https://utils3.cnnd.vn/ajax/weatherinfo/${code}.htm`;
        const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
        const payload = await response.json();

        if (!(payload.Data && payload.Data.success)) throw new Error('API trả về lỗi');

        displayWeather(payload.Data.data.datainfo);
      } catch (e) {
        console.error(e);
        alert('Không thể tải dữ liệu thời tiết. Vui lòng thử lại.');
        hideAll();
      } finally {
        skeleton.style.display = 'none';
      }
    }

    function displayWeather(info) {
      document.getElementById('location').textContent = info.location;
      document.getElementById('temperature').textContent = `${info.temperature}°C`;
      document.getElementById('status').textContent = info.status;
      document.getElementById('high').textContent = info.high;
      document.getElementById('low').textContent = info.low;
      document.getElementById('feels-like').textContent = info.feels_like;
      document.getElementById('humidity').textContent = info.humidity;
      document.getElementById('visibility').textContent = `${info.visibility.index} ${info.visibility.unit}`;
      document.getElementById('uv-index').textContent = `${info.UV_index.index} (${info.UV_index.status})`;
      document.getElementById('wind').textContent = `${info.wind.index} ${info.wind.unit}`;
      document.getElementById('sunrise').textContent = info.sunrise;
      document.getElementById('sunset').textContent = info.sunset;
      document.getElementById('current-icon').src = info.shadow_icon;

      const box = document.getElementById('forecast');
      box.innerHTML = '';
      info.forecast.forEach(day => {
        const el = document.createElement('div');
        el.className = 'fcard';
        el.innerHTML = `
          <p class="d">${day.date}</p>
          <img src="${day.shadow_icon}" alt="icon" class="icon-sm">
          <p class="t">${day.high}° / ${day.low}°</p>
          <p class="s">${day.status}</p>
        `;
        box.appendChild(el);
      });

      weatherWrap.style.display = 'grid';
      forecastWrap.style.display = 'block';
    }
  </script>
</body>
</html>
